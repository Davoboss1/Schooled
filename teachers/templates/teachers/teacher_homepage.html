{% extends 'admins/index.html' %}
{% load static %}
{% block style %}
<style>
	@media screen and (min-width:768px) {
		#main {

			max-height: 90vh;
			overflow-y: auto;
			padding-top: 30px;
		}

		#teacher-tools,
		#teacherProfile {
			max-height: 90vh;
			overflow-y: auto;
			overflow-x: hidden;
			padding-top: 30px;
			background-color: #04091e;
		}

		#teacherProfile div {
			min-width: 300px;
		}
	}

	#teacher-tools,
	#teacherProfile {
		background-color: #04091e;
		border-bottom: 2px dotted white;
		border-top: 2px dotted white;

	}

	@media screen and (max-width:767px) {
		#main {
			padding-top: 15%;
		}

		#teacher-tools,
		#teacherProfile {
			word-wrap: break-word;
			word-break: break-all;
		}
	}

	#register-form .form-group {
		display: flex;
		flex-direction: column;
	}

	.column-form .form-group {
		display: flex;
		flex-direction: column;
	}

	.student-view {
		border: 1px dotted #E2DBDB;
		border-radius: 5px;
		font-size: 15px;
		color: black;
	}

	.no-space {
		margin: 0;
		padding: 0;
	}

	.update-profile-form {
		max-width: 350px;
		margin-left: auto;
		margin-right: auto;
	}
</style>
{% endblock %}
{% block content %}
<!-- ================ start banner Area ================= -->
<section class="home-banner-area">
	<div class="container-fluid">
		<div class="row">
			<div class="main-header">
				<div>
					<h2 class="text-white text-center" style="margin-top: 70px;">
						Welcome {{request.user.get_full_name}}
					</h2>
					<h3 class="text-center my-3">
						<u class="text-white">School: {{request.user.teacher.teacher_class.school.school_name}}</u>
					</h3>
				</div>
			</div>

		</div>
	</div>
</section>



<section>

	<div class="container-fluid">
		<div class="row">

			<div class="col-12 col-sm-12 col-md-3 col-lg-3" id="teacher-tools">
				<h2 class="text-center text-white">Teacher Tools</h2>
				<!-- Teacher tools list-->
				<!-- Onclick event requests data-url attribute value and applies it in div with Id main. -->
				<ul class="list-group my-3" id="toolsList" onclick="ScrollToId('#main',70)">
					<li class="list-group-item tools-list" hx-get="{% url 'students:update' %}" hx-target="#main">
						<h6 class="student-list-link">Add Student Information.</h6>
						<span class="badge badge-info badge-pill">Show</span>
					</li>
					<li class="list-group-item tools-list" hx-get="{% url 'students:edit_students' %}"
						hx-target="#main">
						<h6 class="student-list-link">Edit Student Information.</h6>
						<span class="badge badge-info badge-pill">Show</span>
					</li>
					<li class="list-group-item tools-list" hx-get="{% url 'view_student_info' %}" hx-target="#main">
						<h6 class="student-list-link">View Student Information.</h6>
						<span class="badge badge-info badge-pill">Show</span>
					</li>
					<li class="list-group-item tools-list"
						hx-get="{% url 'students:performance_page' 'view-performance' %}" hx-target="#main">
						<h6 class="student-list-link">View Student Performance.</h6>
						<span class="badge badge-info badge-pill">Show</span>
					</li>
					<li class="list-group-item tools-list"
						hx-get="{% url 'students:performance_page' 'edit-performance' %}" hx-target="#main">
						<h6 class="student-list-link">Edit Student Performance</h6>
						<span class="badge badge-info badge-pill">Show</span>
					</li>
					<li class="list-group-item tools-list"
						hx-get="{% url 'students:attendance_page' 'mark-attendance' %}" hx-target="#main">
						<h6 class="student-list-link">Mark Student Attendance.</h6>
						<span class="badge badge-info badge-pill">Show</span>
					</li>
					<li class="list-group-item tools-list"
						hx-get="{% url 'students:attendance_page' 'view-attendance' %}" hx-target="#main">
						<h6 class="student-list-link">View Student Attendance</h6>
						<span class="badge badge-info badge-pill">Show</span>
					</li>
					<li class="list-group-item tools-list" hx-get="{% url 'accounts:message_list' %}" hx-target="#main">
						<h6 class="student-list-link">Messages</h6>
						<span class="badge badge-danger badge-pill"
							id="unread-messages-count">{{unread_msg_count}}</span>
						<span class="badge badge-info badge-pill">Show</span>
					</li>
				</ul>
				<!-- end of list -->
				<!-- Recent Activities-->
				<h4 class="text-center mb-2 text-info underline">Recent Activities</h4>

				<!-- Recent activities list -->
				<ul class="unordered-list">
					{% for activity in activity_logs|slice:":10" %}
					<li class="text-myinfo">{{activity.Activity_info}}</li>
					{% endfor %}
				</ul>
			</div>

			<div class="col-12 col-sm-12 col-md-6 col-lg-6 d-flex flex-column px-2" id="main">
				<h4 class="mx-auto">No Current Work</h4>
				<div class="m-auto d-flex flex-column"><span class="fa fa-signal mx-auto"
						style="font-size:40px;"></span><small>Nothing to show</small></div>
			</div>


			<!-- Teacher information part. -->
			<div class="col-12 col-sm-12 col-md-3 col-lg-3" id="teacherProfile">
				<div>
					<div class="d-flex flex-column p-3">
						<h4 class="mx-auto mb-3 text-white underline">Teacher Info</h4>
						<div class="d-flex">
							<img class="rounded mr-2" src="{{user.profile_picture.url}}"
								style="width:50px; height:50px;" alt="">
							<ul class="profile-list">
								<li>
									<b>Username: {{user.username}}</b>
								</li>
								<li>
									<b>User Type: {{user.level}} </b>
								</li>
							</ul>
						</div>

						<ul class="unordered-list profile-list">
							<li>
								<b>Full Name: {{user.get_full_name}}</b>
							</li>

							<li>
								<b>Address: {{user.teacher.address}}</b>
							</li>

							<li>
								<b>Email: <a href="mailto:{{user.email}}">{{user.email}}</a></b>

							</li>
							<li>
								<b>Phone no: {{user.teacher.phone_no}}</b>
							</li>
						</ul>
						<h4 class="mx-auto my-3 text-white underline">School Info</h4>

						<div class="d-flex">
							<img class="rounded mr-2"
								src="{% if user.teacher.teacher_class.school.image %}{{user.teacher.teacher_class.school.image.url}}{% endif %}"
								style="width:50px; height:50px;" alt="">
							<ul class="profile-list">
								<li>
									<b>School Name: {{user.teacher.teacher_class.school.school_name}} </b>
								</li>
								<li>
									<b>School Owner: {{user.teacher.teacher_class.school.admin.full_name}} </b>
								</li>

							</ul>
						</div>
						<ul class="unordered-list profile-list">
							<li>
								<b>School type: {{user.teacher.teacher_class.school.type}}</b>
							</li>
							<li>
								<b>School address: {{user.teacher.teacher_class.school.school_address}}</b>
							</li>
							<li>
								<b>Approved: {{user.teacher.teacher_class.school.approved}}</b>
							</li>
							<li>
								<b>School email: {{user.teacher.teacher_class.school.school_email}}</b>
							</li>
						</ul>
						<h4 class="mx-auto my-3 text-white underline">School Owner Info</h4>
						<ul class="unordered-list profile-list">
							<li>
								<b>Name: {{user.teacher.teacher_class.school.admin.full_name}}</b>
							</li>
							<li>
								<b>Username: {{user.teacher.teacher_class.school.admin.user.username}}</b>
							</li>
							<li>
								<b>Address: {{user.teacher.teacher_class.school.admin.address}}</b>
							</li>
							<li>
								<b>Email: {{user.teacher.teacher_class.school.admin.user.email}}</b>
							</li>

							<li>
								<b>Phone number: {{user.teacher.teacher_class.school.admin.phone_no}}</b>
							</li>
						</ul>
						<h4 class="mx-auto my-3 text-white underline">Class Info</h4>
						<ul class="unordered-list profile-list">
							<li>
								<b>Class: {{user.teacher.teacher_class.class_name}}</b>
							</li>
							<li>
								<b>No of Students: {{user.teacher.teacher_class.student_set.all.count}}</b>
							</li>
							<li>
								<b>Teacher: {{user.get_full_name}} ({{user.username}})</b>
							</li>

						</ul>
						<button class="btn btn-outline-light my-2" id="edit-profile-btn">
							Edit Profile
						</button>

					</div>


				</div>
			</div>

		</div>
	</div>
</section>



<!-- Modal -->
<div class="modal fade" id="update-profile-modal" tabindex="-1" role="dialog"
	aria-labelledby="update-profile-modal-title" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="update-profile-modal-title">Update profile</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span
						aria-hidden="true">&times;</span> </button>
			</div>
			<div class="modal-body d-flex flex-column" id="edit-profile-modal-body">

			</div>

		</div>
	</div>
</div>

{% endblock %}
{% block script %}
<script>

	$("#edit-profile-btn").click(function (event) {
		$("#update-profile-modal").modal("show");
		var body = $("#edit-profile-modal-body");
		body.html('<div class="m-auto d-flex flex-column"><div class="mx-auto progressBar"></div><small>Fetching requested items</small></div>');
		$.ajax({
			url: "{% url 'update_profile' %}",
			type: "GET",
			success: function (data) {
				body.html(data);
			},
			error: function (req, status, error) {
				body.html("<div class='d-flex flex-column'><img class='mx-auto' src='{% static 'img/error.png' %}' style='width:50px; height:50px;'><small class='mx-auto text-danger'>Something went wrong.</div>");
			},
		});
	});

</script>

<script>
	document.addEventListener("htmx:xhr:loadstart", function (event, e) {
		let triggeredElement = event.target;
		let target_selector = triggeredElement.getAttribute("hx-target");
		let target = document.querySelector(target_selector);
		target.innerHTML = '<div class="m-auto d-flex flex-column"><div class="mx-auto progressBar"></div><small class="text-center">Fetching requested items</small></div>';
	});
</script>

{% endblock %}